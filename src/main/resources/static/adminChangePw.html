<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>修改密码</title>
    <link rel="stylesheet" href="css/adminChangePw.css">
    <script src="js/jquery-3.5.0.js"></script>
</head>
<script>
    let oldPassword = null, newPassword = null, data = null, pageType = "admin";
    let element_oldPassword = null, element_newPassword = null, element_againPassword = null;

    window.onload = function () {
        element_oldPassword = $("#oldPassword");
        element_newPassword = $("#newPassword");
        element_againPassword = $("#againPassword");

        /*光标处于输入密码框，按回车登录 begin*/
        element_againPassword.bind("keyup", function (e) {
            //event.preventDefault() 方法阻止元素发生默认的行为。
            if (e.key === "Enter") {
                e.preventDefault();
                //按下回车后需要执行的函数
                changePw();
            }
        });
        /*光标处于输入密码框，按回车登录 end*/
    }

    function check() {
        let val = element_oldPassword[0].value;
        oldPassword = val;
        if (val === "" || val === undefined || val == null) {
            alert("请输入原密码");
            element_oldPassword[0].focus();
            return false;
        }
        val = element_newPassword[0].value;
        newPassword = val;
        if (val === "" || val === undefined || val == null) {
            alert("请输入新密码");
            element_newPassword[0].focus();
            return false;
        }
        val = element_againPassword[0].value;
        if (val === "" || val === undefined || val == null) {
            alert("请再次输入新密码");
            element_againPassword[0].focus();
            return false;
        }
        if (val !== newPassword){
            alert("两次输入的密码不相同");
            element_againPassword[0].focus();
            return false;
        }
        return true;
    }

    function changePw() {
        if (check()) {
            //ajax去服务器端校验
            data = {oldPassword: oldPassword, newPassword: newPassword, pageType: pageType};
            alert(Id);
            alert(Name);
            $.ajax({
                type: "POST",
                url: "TTT",
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                data: JSON.stringify(data),
                async: false,
                success: function (msg) {
                    if (msg === true) {
                        //账号密码正确
                        if (loginType === "admin") {
                            window.location.href = "adminMain.html";

                        } else if (loginType === "user") {
                            window.location.href = "userMain.html.html";
                        }
                    } else {
                        alert("用户名或密码错误！");
                    }
                }
            });
        }
    }
</script>
<body>
<div id="login">
    <div class="logo">修改密码</div>
    <div class="main">
        <form class="formname" action="changePassword" name="form1" method="post">
            <ul>
                <li>
                    <label for="oldPassword">原密码：</label>
                    <input class="wa" type="password" id="oldPassword"/>
                </li>
                <li>
                    <label for="newPassword">新密码：</label>
                    <input class="wa" type="password" id="newPassword"/>
                </li>
                <li>
                    <label for="againPassword">再输入：</label>
                    <input class="wa" type="password" id="againPassword"/>
                </li>
                <li>
                    <input type="reset" value="清 空" class="bnt" style="width:48%"/>&nbsp;
                    <input type="button" value="修 改" class="bnt" style="width:48%" onclick="changePw()"/>
                </li>
            </ul>
        </form>
    </div>
</div>
</body>
</html>