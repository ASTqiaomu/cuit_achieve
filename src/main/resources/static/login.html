<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>教师成果管理系统</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="iconfont/style.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="js/jquery-3.5.0.js"></script>
    <script>
        let userName = null, password = null, data = null, loginType = null;
        let element_userName = null;
        let element_password = null;
        let element_loginType = null;

        window.onload=function(){
            element_userName = $("#userName");
            element_password = $("#password");
            element_loginType = document.getElementsByName("loginType");

            /*光标处于输入密码框，按回车登录 begin*/
            element_password.bind("keyup", function (e) {
                //event.preventDefault() 方法阻止元素发生默认的行为。
                if (e.key === "Enter") {
                    e.preventDefault();
                    //按下回车后需要执行的函数
                    login();
                }
            });
            /*光标处于输入密码框，按回车登录 end*/
        }

        function check() {
            let val = element_userName[0].value;
            userName = val;
            if (val === "" || val === undefined || val == null) {
                alert("用户名不能为空");
                element_userName[0].focus();
                return false;
            }
            val = element_password[0].value;
            password = val;
            if (val === "" || val === undefined || val == null) {
                alert("密码不能为空");
                element_password[0].focus();
                return false;
            }
            for (let i = 0; i < element_loginType.length; i++){
                if (element_loginType[i].checked){
                    loginType = element_loginType[i].id;
                    break;
                }
            }
            return true;
        }
        function login(){
            if (check()){
                //ajax去服务器端校验
                data = {userName: userName, password: password, loginType: loginType};
                $.ajax({
                    type: "POST",
                    url: "login",
                    contentType: "application/json; charset=utf-8",
                    dataType: 'json',
                    data: JSON.stringify(data),
                    async: false,
                    success: function (msg) {
                        if (msg === true) {
                            //账号密码正确
                            if (loginType === "admin"){
                                window.location.href = "adminMain.html";

                            }else if (loginType === "user"){
                                window.location.href = "userMain.html.html";
                            }
                        }else{
                            alert("用户名或密码错误！");
                        }
                    }
                });
            }
        }
    </script>
</head>
<body style="background:url(img/bg.jpg) no-repeat;">
<div class="container wrap1" style="height:450px;">
    <h2 class="mg-b20 text-center">教师成果管理系统</h2>
    <div class="col-sm-8 col-md-5 center-auto pd-sm-50 pd-xs-20 main_content">
        <p class="text-center font20">用户登录</p>
        <form id="fm" action="login" method="post">
            <div class="form-group mg-t20">
                <i class="icon-user icon_font"></i>
                <label for="userName" style="display: none"></label>
                <input class="login_input" id="userName" type="text" name="userName"
                       placeholder="请输入用户名" required autofocus>
            </div>
            <div class="form-group mg-t20">
                <i class="icon-lock icon_font"></i>
                <label for="password" style="display: none"></label>
                <input class="login_input" id="password" type="password" name="password"
                       placeholder="请输入密码" required>
            </div>
            <div class="checkbox mg-b25">
                <label>
                    <input name="loginType" checked type="radio" value="admin" id="admin">
                    <label class="custom-control-label" for="admin">管理员</label>
                </label>
                <label>
                    <input name="loginType" type="radio" class="custom-control-input" value="user" id="user">
                    <label class="custom-control-label" for="user">老师</label>
                </label>
            </div>
            <input class="login_btn" type="button" value="登 录" onclick="login()">
        </form>
    </div>
</div>
</body>
</html>